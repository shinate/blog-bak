---
layout: post
status: publish
published: true
title: wordpress技巧不完全收集
author:
  display_name: "莳子"
  login: admin
  email: shine.wangrs@gmail.com
  url: http://codante.org
author_login: admin
author_email: shine.wangrs@gmail.com
author_url: http://codante.org
excerpt: "平时收集的一些wordpress长用技巧，有模板、数据库、功能等方面的。"
wordpress_id: 77
wordpress_url: http://codante.org/?p=77
date: '2010-07-05 09:08:19 +0800'
date_gmt: '2010-07-05 01:08:19 +0800'
---
<h2>按分类提取文章</h2>
<p>必须将$posts暂时保存起来，否则，提取的过程会破坏页面本身的数据。<br />
[php]<br />
<?php<br />
$tmp_posts = $posts;<br />
$posts = get_posts( "category=4&numberposts=10" ); ?><br />
<?php if( $posts ) : ?></p>
<ul>
    <?php foreach( $posts as $post ) : setup_postdata( $post ); ?></p>
<li>
        <a href="<?php the_permalink() ?>" rel="bookmark" title="<?php the_title(); ?>"><?php the_title(); ?></a>
    </li>
<p>    <?php endforeach; ?>
</ul>
<p><?php endif;<br />
$posts = $tmp_post;<br />
?><br />
[/php]</p>
<h2>禁用文章版本管理</h2>
<p>方法：打开 Wordpress 根目录下的 wp-config.php 文件，添加如下行即可：<br />
[php]define('WP_POST_REVISIONS', false);[/php]<br />
禁用版本管理功能以后，之前已经生成的版本记录还是存在的，通过以下 SQL 语句可以删除：<br />
[code]<br />
DELETE FROM wp_postmeta WHERE post_id IN (SELECT id FROM wp_posts WHERE post_type = 'revision');<br />
DELETE FROM wp_term_relationships WHERE object_id IN (SELECT id FROM wp_posts WHERE post_type='revision');<br />
DELETE FROM wp_posts WHERE post_type='revision';<br />
[/code]</p>
<h2>每页显示数量</h2>
<p>[php]<br />
<?php $posts = query_posts($query_string . '&orderby=date&showposts=5');?><br />
[/php]<br />
还可以添加条件判断，如下：当页面为分类列表页时，显示15条。<br />
[php]<br />
<?php<br />
if (is_category()) {<br />
    $posts = query_posts($query_string . '&orderby=date&showposts=15');<br />
}<br />
?><br />
[/php]</p>
<h2>批量替换文章内链接地址</h2>
<p>当域名进行更改时，可以使用此SQL语句。<br />
[code]<br />
UPDATE `{PREFIX}_posts` SET `post_content`=replace( `post_content` , '{FIND}', '{REPLACE}') WHERE `post_content` LIKE '%{FIND}%';<br />
[/code]</p>
<h2>分页显示评论</h2>
<p>类似于插件pagenavi的样子，显示多页索引<br />
[php]<br />
<?php<br />
if (get_option('page_comments')) {<br />
    $comment_pages = paginate_comments_links('echo=0');<br />
    if ($comment_pages) {<br />
?></p>
<div class="navigation">
            <?php echo $comment_pages; ?>
        </div>
<p><?php<br />
    }<br />
}<br />
?><br />
[/php]</p>
<h2>提取文章自定义域</h2>
<p>已有the_post时:<br />
[php]post_custom('名称');[/php]<br />
单独提取某文章的所有自定义域<br />
[php]get_post_custom( $post_id );[/php]</p>
<h2>文章列表同时排除置顶的</h2>
<p>[php]<br />
$paged = (get_query_var('paged')) ? get_query_var('paged') : 1;<br />
$sticky=get_option('sticky_posts');<br />
$args=array(<br />
    'cat'=>$cat,<br />
    'caller_get_posts'=>1,<br />
    'post__not_in' => $sticky,<br />
    'paged'=>$paged,<br />
);<br />
query_posts($args);<br />
[/php]</p>
<h2>提取文章中的图片</h2>
<p>[php]<br />
<?php<br />
if (have_posts()) :<br />
while (have_posts()) : the_post();<br />
    preg_match_all( '/<img[^\>]*\ />/', $post->post_content, $aPics );<br />
    $numOfPics = count($aPics[0]);<br />
    if ( $numOfPics > 0 )<br />
        foreach ( $aPics[0] as $img )<br />
            $imga[]=$img;<br />
    endwhile;<br />
endif;<br />
?><br />
[/php]</p>
<h2>定义自己的搜索框</h2>
<p>通过filter滤镜将表单的结构重置，注意：字段名不可以改变，就是所有的name属性和值都要保留。<br />
打开主题文件夹中的functions.php，没有请自行创建，添加以下代码<br />
[php]<br />
function my_search_form($form) {<br />
    $form = '
<div>
<div class="searchform" id="searchform">
<form method="get" action="' . get_option('home') . '/" >
    <label class="hidden" for="s">' . __('Search for:') . '</label><br />
    <input type="text" autocomplete="off" value="' . attribute_escape(apply_filters('the_search_query', get_search_query())) . '" name="s" id="s" /><br />
    <input type="submit" id="searchsubmit" value="'.attribute_escape(__('Search')).'" /><br />
    </form>
</div>
</div>
<p>';<br />
    return $form;<br />
}<br />
add_filter('get_search_form', 'my_search_form');<br />
[/php]<br />
如果已经安装了某些表单插件或者做过处理，可以将add_filter添加一个参数，如下<br />
[php]<br />
add_filter('get_search_form', 'my_search_form', 200);<br />
[/php]</p>
<h2>自定义评论模板</h2>
<p>wordpress中的自带方法wp_list_comments提供了回调，可以根据自己的需求来调整评论模版的结构或样式。<br />
首先在 Wordpress 主题的 functions.php 中添加对评论样式定义的 mytheme_comment 函数，默认值如下：<br />
[php]<br />
function mytheme_comment($comment, $args, $depth) {<br />
    $GLOBALS['comment'] = $comment;<br />
?></p>
<li <?php comment_class(); ?> id="li-comment-<?php comment_ID() ?>">
<div id="comment-<?php comment_ID(); ?>"></p>
<div class="comment-author vcard">
            <?php echo get_avatar($comment,$size='32',$default='
<path_to_url>' ); ?><br />
            <?php printf(__('<cite class="fn">%s</cite> <span class="says">says:</span>'), get_comment_author_link()) ?>
        </div>
<p>        <?php if ($comment->comment_approved == '0') : ?><br />
            <em><?php _e('Your comment is awaiting moderation.') ?></em><br />
        <?php endif; ?></p>
<div class="comment-meta commentmetadata"><a href="<?php echo htmlspecialchars( get_comment_link( $comment->comment_ID ) ) ?>"><?php printf(__('%1$s at %2$s'), get_comment_date(),  get_comment_time()) ?></a><?php edit_comment_link(__('(Edit)'),'  ','') ?></div>
<p>        <?php comment_text() ?></p>
<div class="reply">
            <?php comment_reply_link(array_merge( $args, array('depth' => $depth, 'max_depth' => $args['max_depth']))) ?>
        </div>
</p></div>
<p><?php<br />
}<br />
[/php]<br />
调用方法：在 Wordpress 主题的 comments.php 中用 callback 回调函数引入之前定义的 mytheme_comment 函数<br />
[php]</p>
<ul class="commentlist">
    <?php wp_list_comments('type=comment&callback=mytheme_comment'); ?>
</ul>
<p>[/php]</p>
