---
layout: post
status: publish
published: true
title: LINUX+PHP实现网页快照（截屏）
author:
  display_name: "莳子"
  login: admin
  email: shine.wangrs@gmail.com
  url: http://codante.org
author_login: admin
author_email: shine.wangrs@gmail.com
author_url: http://codante.org
wordpress_id: 674
wordpress_url: http://codante.org/?p=674
date: '2012-08-24 20:08:17 +0800'
date_gmt: '2012-08-24 12:08:17 +0800'
---
<h2>服务器端</h2>
<p>为实现截图的程序必须借助服务器端程序：http://code.google.com/p/wkhtmltopdf/</p>
<p>可将网页转换为pdf或者图片，32和64位有区别，找个适合自己服务器的版本。</p>
<h3>安装</h3>
<p>安装过程十分简单：解压 -&gt; 找个合适的路径放下...</p>
<h3>执行</h3>
<pre>命令行调用</pre>
<pre>[bash]
/servers/app/qtwebkit/wkHtmlToImage weibo.com weibo.com.png
[/bash]</pre>
<p>默认的清晰度比较高，图片会很大，生成图片需要一定的时间。</p>
<p>php</p>
<pre>[php]
exec('/servers/app/qtwebkit/wkHtmlToImage weibo.com weibo.com.png');
[/php]</pre>
<p>具体的使用方法</p>
<pre>[php]
&lt;?php
ob_start();
//如果将输出的文件名设置为'-'，则直接返回文件数据流
passthru('/servers/app/qtwebkit/wkHtmlToImage --width 800 --height 600 -quality 85 weibo.com -');
$fileName = self::cachePath() . '/' . self::name();
$content = ob_get_clean();

//写入图片文件，备用
//file_put_contents($fileName, $content);

//直接输出为图片
header("Content-type: image/png");
echo $content;
?&gt;
[/php]</pre>
<h3>中文乱码问题</h3>
<p>主要看服务器是否支持中文语言，如果截图中出现乱码，直接装个中文包就好了。</p>
<p>[bash]<br />
yum install fonts-chinese<br />
[/bash]</p>
